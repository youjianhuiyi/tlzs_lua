PushDebugMessage("?????????????????")
-- ??????????????????????????? ======???????????======
local BaoLiu = 0
local nTick = 0
local yuanbao = Player:GetDataInt('YUANBAO')

function exchangeYB()
	while true do
		-- ?????????????
		local yuanbao = Player:GetDataInt('YUANBAO')
		-- ?????????????
		if yuanbao <= BaoLiu then break end
		--?????
		MoveToNPC(65, 42, 224, "?????"); Sleep(600)
		-- ????????????
		if nTick == 0 then nTick = GetTickCount() end
		-- ????30????????
		if nTick ~= 0 and GetTickCount() - nTick > 30 * 1000 then break end
		-- ????????????????
		local nNeed = yuanbao - BaoLiu
		-- ??¦Æ????????50000???
		if nNeed > 50000 then nNeed = 50000 end
		if nNeed <= 0 then break end
		-- ??????
		Player:YB2Ticket(nNeed)
		Sleep(1000)
	end
end


--[[?????????????????????--]]
function findBaseItemsToBank()
    --??????????????????????????
    GetLuaValue("setmetatable(_G, {__index = MainMenuBar_Env});MainMenuBar_Packet_Clicked();","",0);Sleep(1000);
    GetLuaValue("setmetatable(_G, {__index = Packet_Env});Packet_ChangeTabIndex(0);","",0);Sleep(1000);
    for i=0,29 do
        local nId = GetLuaValue("local theAction = EnumAction("..i ..", 'packageitem');return theAction:GetID();","n",1);Sleep(100);
        if nId~=0 then
            sName = GetLuaValue("local theAction = EnumAction("..i ..", 'packageitem');return theAction:GetName();","s",1);Sleep(100);
            CurrNum = GetLuaValue("return DataPool:GetBaseBag_Num();","n",1);Sleep(100);--[[????????????????§Ø????????--]]
            CurrNum_Mat = GetLuaValue("return DataPool:GetMatBag_Num();","n",1);Sleep(100);--[[????????????????§Ø????????--]]
        end
        -- ???????????????????????????????????
        if sName == "????" then
            xPos = math.floor(i/5 + 1);
            yPos = i-((xPos-1)*5) + 1;
            -- PushDebugMessage("xPos??"..xPos..";yPos??"..yPos.."??????????"..sName);
			GetLuaValue("setmetatable(_G, {__index = Banghui_Bank_Env});Banghui_Bank_patulousBox_Clicked(1);","",0);Sleep(1000);
            GetLuaValue("setmetatable(_G, {__index = Packet_Env});Packet_ItemBtnClicked("..xPos..","..yPos..");","",0);Sleep(100);
			GetLuaValue("setmetatable(_G, {__index = Banghui_Bank_Env});Banghui_Bank_patulousBox_Clicked(2);","",0);Sleep(1000);
            GetLuaValue("setmetatable(_G, {__index = Packet_Env});Packet_ItemBtnClicked("..xPos..","..yPos..");","",0);Sleep(100);
			GetLuaValue("setmetatable(_G, {__index = Banghui_Bank_Env});Banghui_Bank_patulousBox_Clicked(3);","",0);Sleep(1000);
            GetLuaValue("setmetatable(_G, {__index = Packet_Env});Packet_ItemBtnClicked("..xPos..","..yPos..");","",0);Sleep(100);
			GetLuaValue("setmetatable(_G, {__index = Banghui_Bank_Env});Banghui_Bank_patulousBox_Clicked(4);","",0);Sleep(1000);
            GetLuaValue("setmetatable(_G, {__index = Packet_Env});Packet_ItemBtnClicked("..xPos..","..yPos..");","",0);Sleep(100);
			sName = nil;
			--[[?????????§Ö?16??????????????????????????????????16????????????--]]
        end
    end
end


--PushDebugMessage("?????????")
exchangeYB();
--QuestFrameOptionClicked("?????????");Sleep(3000)
PushDebugMessage("#eDC4C18#cFFFF00????????????????????????§µ???")
if CityToGuild() then
    MoveToNPC(148, 56, -1, "???"); Sleep(1500)
    QuestFrameOptionClicked("???????",1); Sleep(3000)
	findBaseItemsToBank();
-- GuildToCity()??????????????????????
end

if yuanbao > 0 then
	exchangeYB();
	if CityToGuild() then
		MoveToNPC(148, 56, -1, "???"); Sleep(1500)
		QuestFrameOptionClicked("???????",1); Sleep(3000)
		findBaseItemsToBank();
	end
end
-- ?????????????? FQ_101210_27